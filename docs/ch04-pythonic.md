# ç¬¬ 4 ç« ï¼šPythonic ä¹‹é“ â€”â€” æ¨å¯¼å¼ä¸æ­£åˆ™

> **"Brevity is the soul of wit."**
>
> **â€œç®€æ´æ˜¯æ™ºæ…§çš„çµé­‚ã€‚â€**
>
> â€” _å¨å»‰Â·èå£«æ¯”äºšï¼Œã€Šå“ˆå§†é›·ç‰¹ã€‹ (William Shakespeare, Hamlet)_

---

ä»€ä¹ˆæ˜¯ **Pythonic**ï¼Ÿå®ƒä¸ä»…æ˜¯æŒ‡éµå¾ª PEP 8 æ ¼å¼è§„èŒƒï¼Œæ›´æ˜¯ä¸€ç§è¿½æ±‚ä»£ç â€œç®€æ´ã€æ˜ç¡®ã€å¯è¯»â€çš„æ€ç»´æ–¹å¼ã€‚

åœ¨ Python ç¤¾åŒºï¼Œå¦‚æœä½ å†™äº† C è¯­è¨€é£æ ¼çš„ `for i in range(len(list))`ï¼Œæˆ–è€…å†™äº† Java é£æ ¼çš„ Getter/Setterï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸å¤Ÿ Pythonic çš„ã€‚æœ¬ç« æˆ‘ä»¬å°†å­¦ä¹  Python æœ€è¿·äººçš„è¯­æ³•ç³–â€”â€”æ¨å¯¼å¼ï¼Œä»¥åŠå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ã€‚

## 4.1 æ¨å¯¼å¼ (Comprehensions)ï¼šä¸€è¡Œèƒœåè¡Œ

å¦‚æœä½ è¿˜åœ¨ç”¨ `for` å¾ªç¯åˆ›å»ºä¸€ä¸ªç»è¿‡è¿‡æ»¤æˆ–å¤„ç†çš„æ–°åˆ—è¡¨ï¼Œé‚£ä¹ˆè¯·åœä¸‹æ¥ã€‚æ¨å¯¼å¼æ˜¯ Python çš„æ ‡å¿—æ€§ç‰¹æ€§ï¼Œå®ƒæ—¢é«˜æ•ˆåˆæ˜“è¯»ã€‚

### 4.1.1 åˆ—è¡¨æ¨å¯¼å¼ (List Comprehension)

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ç§å†™æ³•çš„å¯¹æ¯”ï¼š

::: code-group

```python [ä¼ ç»Ÿå†™æ³• (C/JS é£æ ¼)]
numbers = [1, 2, 3, 4, 5]
squared = []

for n in numbers:
    if n % 2 == 0:
        squared.append(n * n)

# ç»“æœ: [4, 16]
```

```python [Pythonic å†™æ³•]
numbers = [1, 2, 3, 4, 5]

# [è¡¨è¾¾å¼ for å˜é‡ in å®¹å™¨ if æ¡ä»¶]
# è¯»ä½œï¼š"å¯¹äº numbers ä¸­çš„æ¯ä¸ª nï¼Œå¦‚æœ n æ˜¯å¶æ•°ï¼Œå°±è®¡ç®— n*n æ”¾å…¥åˆ—è¡¨"
squared: list[int] = [n * n for n in numbers if n % 2 == 0]
```

:::

è¿™ä¸ä»…ä»…æ˜¯è¯­æ³•ç³–ï¼Œå®ƒåœ¨è§£é‡Šå™¨å±‚é¢è¿›è¡Œäº†ä¼˜åŒ–ï¼ˆç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤æ›´å°‘ï¼‰ï¼Œé€šå¸¸æ¯”ç­‰ä»·çš„ `for` å¾ªç¯**æ›´å¿«**ã€‚

::: info ğŸ“ TS å¼€å‘è€…ä¾¿ç­¾ï¼šMap & Filter
åˆ—è¡¨æ¨å¯¼å¼æœ¬è´¨ä¸Šå°±æ˜¯ TS ä¸­çš„ `.map().filter()` é“¾å¼è°ƒç”¨çš„ç»“åˆä½“ã€‚

- **TS**:
  ```typescript
  const squared = numbers.filter((n) => n % 2 === 0).map((n) => n * n);
  ```
- **Python**:
  ```python
  squared = [n * n for n in numbers if n % 2 == 0]
  ```

**æ–‡åŒ–å·®å¼‚**ï¼šè™½ç„¶ Python ä¹Ÿæœ‰ `map()` å’Œ `filter()` å‡½æ•°ï¼Œä½†åœ¨ Python ç¤¾åŒºä¸­ï¼Œ**æ¨å¯¼å¼**æ˜¯ç»å¯¹çš„é¦–é€‰ã€‚é™¤éä½ éœ€è¦æ‡’åŠ è½½ï¼ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼‰ï¼Œå¦åˆ™å°½é‡å°‘å†™ `map(lambda x: ..., data)`ï¼Œå› ä¸ºæ¨å¯¼å¼é€šå¸¸å¯è¯»æ€§æ›´å¼ºã€‚
:::

### 4.1.2 å­—å…¸ä¸é›†åˆæ¨å¯¼å¼

ä¸è¦åªç›¯ç€åˆ—è¡¨ï¼Œå­—å…¸å’Œé›†åˆä¹Ÿèƒ½æ¨å¯¼ã€‚

```python
users = [("Alice", 101), ("Bob", 102), ("Charlie", 103)]

# å­—å…¸æ¨å¯¼å¼ï¼šå¿«é€Ÿæ„å»º lookup table
# è¯­æ³•ï¼š{key_expr: value_expr for ...}
user_map: dict[str, int] = {name: uid for name, uid in users}
# ç»“æœ: {'Alice': 101, 'Bob': 102, ...}

# é›†åˆæ¨å¯¼å¼ï¼šå¿«é€Ÿå»é‡å¹¶å¤„ç†
# è¯­æ³•ï¼š{value_expr for ...}
raw_tags = [" python ", "Code", "PYTHON", " code "]
unique_tags: set[str] = {t.strip().lower() for t in raw_tags}
# ç»“æœ: {'python', 'code'}
```

## 4.2 ç”Ÿæˆå™¨è¡¨è¾¾å¼ (Generator Expression) â€”â€” å†…å­˜çš„æ•‘æ˜Ÿ

æ¨å¯¼å¼è™½å¥½ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼š**æ¸´æœ›æ‰§è¡Œ (Eager Evaluation)**ã€‚
`[x for x in range(10000000)]` ä¼šç«‹å³åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€åƒä¸‡ä¸ªæ•´æ•°ï¼Œç¬é—´æ’‘çˆ†å†…å­˜ã€‚

å¦‚æœä½ åªæ˜¯æƒ³éå†å®ƒï¼Œæˆ–è€…è®¡ç®—å®ƒçš„æ€»å’Œï¼Œåªéœ€æŠŠ**ä¸­æ‹¬å· `[]` æ¢æˆå°æ‹¬å· `()`**ã€‚

```python
from collections.abc import Iterator

# è¿™ä¸ä¼šç«‹å³è®¡ç®—ï¼Œè€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œå ç”¨çš„å†…å­˜å¾®ä¹å…¶å¾®
# è¿™é‡Œçš„ç±»å‹æ³¨è§£æ˜¯ Iterator
large_stream: Iterator[int] = (x * x for x in range(1_000_000))

# é…åˆ sum, any, all ç­‰å‡½æ•°ä½¿ç”¨éå¸¸ä¼˜é›…
# æ³¨æ„ï¼šå½“å®ƒæ˜¯å‡½æ•°å”¯ä¸€å‚æ•°æ—¶ï¼Œå¯ä»¥çœç•¥ä¸€å±‚æ‹¬å·ï¼Œè¿™éå¸¸ Pythonic
total = sum(x * x for x in range(100))
```

::: info ğŸ“ TS å¼€å‘è€…ä¾¿ç­¾ï¼šLazy Evaluation

- **List Comp `[]`**: ç±»ä¼¼ TS çš„ `Array.map`ï¼Œç«‹å³ç”Ÿæˆæ•°ç»„ã€‚
- **Gen Exp `()`**: ç±»ä¼¼ TS çš„ Generator å‡½æ•°æˆ– Iteratorã€‚å®ƒåªåœ¨ä½ è°ƒç”¨ `next()` æˆ–éå†æ—¶æ‰è®¡ç®—ä¸‹ä¸€ä¸ªå€¼ã€‚

**æœ€ä½³å®è·µ**ï¼šå¦‚æœåˆ—è¡¨å¾ˆå¤§ï¼Œæˆ–è€…ä½ åªéœ€è¦éå†ä¸€æ¬¡ï¼Œ**æ°¸è¿œä¼˜å…ˆä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼**ã€‚
:::

## 4.3 æ­£åˆ™è¡¨è¾¾å¼ (Regex) ä¸ç±»å‹æ³¨è§£

Python çš„æ­£åˆ™æ¨¡å—æ˜¯ `re`ã€‚è™½ç„¶æ­£åˆ™è¯­æ³•æœ¬èº«å„è¯­è¨€éƒ½å·®ä¸å¤šï¼Œä½†åœ¨ Python ä¸­ç»“åˆç±»å‹æ³¨è§£ä½¿ç”¨æ—¶ï¼Œæœ‰ä¸€äº›ä¼˜é›…çš„å§¿åŠ¿ã€‚

### 4.3.1 é¢„ç¼–è¯‘ä¸ Raw String

åœ¨ Python ä¸­å†™æ­£åˆ™ï¼Œæ°¸è¿œè¦ä½¿ç”¨ `r"..."` (Raw String)ã€‚å®ƒå‘Šè¯‰ Python è§£é‡Šå™¨ä¸è¦è½¬ä¹‰åæ–œæ  `\`ã€‚
å¦‚æœä¸åŠ  `r`ï¼ŒåŒ¹é…æ•°å­— `\d` å°±å¾—å†™æˆ `\\d`ï¼ŒåŒ¹é…åæ–œæ æœ¬èº«å°±å¾—å†™æˆ `\\\\`ï¼Œç®€ç›´æ˜¯åœ°ç‹±ã€‚

```python
import re

# 1. é¢„ç¼–è¯‘æ­£åˆ™ (Pre-compile)
# è¿™æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ï¼Œæå‡æ€§èƒ½ï¼Œä¸”èƒ½æå‰å‘ç°æ­£åˆ™è¯­æ³•é”™è¯¯
# æ¨¡å¼ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—
DIGIT_PATTERN: re.Pattern = re.compile(r"\d+")

def extract_ids(text: str) -> list[int]:
    # findall è¿”å› list[str]
    matches: list[str] = DIGIT_PATTERN.findall(text)
    return [int(m) for m in matches] # ç»“åˆåˆ—è¡¨æ¨å¯¼å¼
```

### 4.3.2 å‘½ååˆ†ç»„ä¸ç±»å‹

Python çš„æ­£åˆ™æ”¯æŒå‘½ååˆ†ç»„ `(?P<name>...)`ï¼Œè¿™æ¯”é€šè¿‡ç´¢å¼• `group(1)` è®¿é—®è¦å¥å£®å¾—å¤šã€‚

```python
def parse_email(text: str) -> dict[str, str] | None:
    # å®šä¹‰æ­£åˆ™ï¼šæå– user å’Œ domain
    pattern = re.compile(r"(?P<user>[\w\.]+)@(?P<domain>[\w\.]+)")

    # match è¿”å› Match å¯¹è±¡æˆ– None
    match: re.Match | None = pattern.search(text)

    if not match:
        return None

    # groupdict ç›´æ¥æŠŠå‘½ååˆ†ç»„è½¬ä¸ºå­—å…¸ï¼Œæå…¶æ–¹ä¾¿
    return match.groupdict()

# æµ‹è¯•
print(parse_email("Contact: alice.dev@google.com"))
# è¾“å‡º: {'user': 'alice.dev', 'domain': 'google.com'}
```

::: tip ğŸ” Regex å·®å¼‚ç‚¹
TS/JS æœ‰å­—é¢é‡æ­£åˆ™ `/pattern/g`ï¼Œå¼•æ“ä¼šè‡ªåŠ¨ç¼“å­˜ã€‚
Python æ²¡æœ‰ `/.../` è¯­æ³•ï¼Œå¿…é¡»å¼•å…¥ `re` æ¨¡å—ã€‚ä½¿ç”¨ `re.compile()` æ˜¯æœ€ä½³å®è·µï¼Œå®ƒå¯¹åº”äº† JS å¼•æ“çš„è‡ªåŠ¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…äº†åœ¨å¾ªç¯ä¸­é‡å¤è§£ææ­£åˆ™å­—ç¬¦ä¸²ã€‚
:::

## 4.4 Python ä¹‹ç¦… (The Zen of Python)

æœ€åï¼Œæˆ‘ä»¬æ¥èŠèŠâ€œé£æ ¼â€ã€‚åœ¨ç»ˆç«¯è¾“å…¥ `python -c "import this"`ï¼Œä½ ä¼šçœ‹åˆ° Tim Peters å†™çš„ 19 æ¡å‡†åˆ™ã€‚

ä½œä¸º Python å¼€å‘è€…ï¼Œæœ‰å‡ æ¡å¿…é¡»é“­è®°äºå¿ƒï¼š

1.  **Explicit is better than implicit.** (æ˜¾å¼ä¼˜äºéšå¼)
    - è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¨å´‡å†™ç±»å‹æ³¨è§£ï¼Œæ¨å´‡æ˜¾å¼çš„ `self`ï¼Œè€Œä¸æ˜¯éšå¼çš„ `this`ã€‚
2.  **Flat is better than nested.** (æ‰å¹³ä¼˜äºåµŒå¥—)
    - å°½æ—© `return`ï¼Œå‡å°‘ `if/else` çš„å±‚çº§ã€‚
3.  **Readability counts.** (å¯è¯»æ€§å¾ˆé‡è¦)
    - ä»£ç æ˜¯å†™ç»™äººçœ‹çš„ï¼Œé¡ºä¾¿ç»™æœºå™¨è¿è¡Œã€‚

### å®æˆ˜ï¼šæµ·è±¡è¿ç®—ç¬¦ (Walrus Operator `:=`)

Python 3.8 å¼•å…¥çš„ `:=` æ˜¯å¯¹â€œæ‰å¹³åŒ–â€çš„ä¸€ç§å®è·µã€‚å› ä¸º `:=` çœ‹èµ·æ¥åƒæµ·è±¡çš„çœ¼ç›å’Œé•¿ç‰™ï¼Œæ‰€ä»¥å¾—åâ€œæµ·è±¡è¿ç®—ç¬¦â€ã€‚å®ƒå…è®¸ä½ åœ¨**è¡¨è¾¾å¼å†…éƒ¨èµ‹å€¼**ã€‚

::: code-group

```python [Old (Nested)]
match = pattern.search(text)
if match:
    process(match)
```

```python [New (Pythonic)]
# åœ¨ if æ¡ä»¶åˆ¤æ–­çš„åŒæ—¶ï¼Œå°†ç»“æœèµ‹å€¼ç»™ match å˜é‡
if match := pattern.search(text):
    process(match)
```

:::

è¿™å‡å°‘äº†ä¸´æ—¶å˜é‡çš„ä½œç”¨åŸŸæ³„éœ²ï¼Œä½¿ä»£ç é€»è¾‘æ›´ç´§å‡‘ã€‚

## æœ¬ç« å°ç»“

è¿™ä¸€ç« æˆ‘ä»¬å­¦ä¹ äº† Python çš„â€œå†…åŠŸå¿ƒæ³•â€ã€‚

1.  **æ¨å¯¼å¼**ï¼šç”¨ `[x for x in ...]` æ›¿ä»£ `.map().filter()`ï¼Œé«˜æ•ˆä¸”ä¼˜é›…ã€‚
2.  **ç”Ÿæˆå™¨**ï¼šç”¨ `(x for x in ...)` å¤„ç†å¤§æ•°æ®æµï¼ŒèŠ‚çœå†…å­˜ã€‚
3.  **æ­£åˆ™**ï¼šä½¿ç”¨ `r""` åŸå§‹å­—ç¬¦ä¸²å’Œ `re.compile`ã€‚
4.  **é£æ ¼**ï¼šè¿½æ±‚æ‰å¹³ã€æ˜¾å¼å’Œå¯è¯»æ€§ã€‚

ç°åœ¨ï¼Œä½ å·²ç»èƒ½å†™å‡ºæ¼‚äº®çš„ Python è¯­å¥äº†ã€‚ä½†æ˜¯ï¼Œéšç€é€»è¾‘å˜å¾—å¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¼ºå¤§çš„æ§åˆ¶æµå·¥å…·ã€‚ä½ æ˜¯å¦åŒå€¦äº† `if-elif-else` çš„é•¿é“¾æ¡ï¼Ÿ

ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†è¿›å…¥ **é€»è¾‘ä¹‹ç¾**ã€‚æˆ‘ä»¬å°†ä»‹ç» Python 3.10 å¼•å…¥çš„ç»“æ„åŒ–æ¨¡å¼åŒ¹é… (`match case`)ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ç±»å‹ç³»ç»Ÿåšâ€œç±»å‹æ”¶çª„â€ã€‚è¿™å¯æ˜¯ TS å¼€å‘è€…æœ€å–œæ¬¢çš„åŠŸèƒ½ä¹‹ä¸€ã€‚

::: warning ğŸ§  è¯¾åæ€è€ƒ
åˆ—è¡¨æ¨å¯¼å¼è™½ç„¶å¥½ï¼Œä½†å¦‚æœé€»è¾‘å¤ªå¤æ‚ï¼ˆæ¯”å¦‚åŒ…å«åŒé‡å¾ªç¯å’Œå¤šä¸ª `if`ï¼‰ï¼Œå†™åœ¨ä¸€è¡Œé‡Œä¼šå˜æˆâ€œå¤©ä¹¦â€ã€‚

Python ç¤¾åŒºå¯¹äºæ¨å¯¼å¼çš„å¯è¯»æ€§æœ‰ä¸€ä¸ªä¸æˆæ–‡çš„çº¦å®šï¼š**å¦‚æœä¸€ä¸ªæ¨å¯¼å¼è¶…è¿‡äº† **\_** æˆ–è€…é€»è¾‘è¿‡äºåµŒå¥—ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ**

ï¼ˆç­”æ¡ˆæ˜¯ï¼šæ”¾å¼ƒæ¨å¯¼å¼ï¼Œè€è€å®å®å†™ `for` å¾ªç¯ã€‚å¯è¯»æ€§ > ç‚«æŠ€ã€‚ï¼‰
:::
